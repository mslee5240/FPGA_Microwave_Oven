# Smart Microwave Oven Controller - BASYS-3 FPGA

BASYS-3 보드를 이용한 지능형 전자레인지 제어 시스템 구현 프로젝트

## 프로젝트 개요

Xilinx BASYS-3 FPGA 보드와 Vivado를 사용하여 구현한 완전한 전자레인지 제어 시스템입니다. 5상태 FSM 기반으로 동작하며, 서보모터 문 제어, DC모터 플레이트 회전, 부저 피드백, 7-segment 디스플레이 등 실제 전자레인지의 모든 기능을 구현했습니다.

## 주요 기능

### 시간 설정 및 타이머
- **최대 시간**: 60분 (3600초)
- **시간 추가**: 10초 단위, 1분 단위 추가 가능
- **퀵스타트**: 더블클릭으로 30초 즉시 시작
- **실시간 카운트다운**: 1초 단위 정확한 타이머

### 하드웨어 제어
- **서보모터**: 문 자동 개폐 제어 (0도/90도)
- **DC모터**: 작동 중 플레이트 회전 (PWM 제어)
- **부저**: 버튼음(1000Hz), 완료음(800Hz)
- **7-segment 디스플레이**: 시간 표시 및 IDLE 애니메이션

### 안전 기능
- **문 열림 감지**: 문이 열리면 자동 일시정지
- **완료 알림**: 5회 점멸 + 1초 알림음
- **상태 기반 제어**: 안전한 상태 전환

## 상태 머신 (5-State FSM)

### 상태 정의
1. **IDLE**: 대기 상태 (서클 애니메이션 표시)
2. **SETTING**: 시간 설정 중
3. **RUNNING**: 작동 중 (모터 회전, 타이머 진행)
4. **PAUSED**: 일시정지 (문 열림 또는 사용자 요청)
5. **COMPLETE**: 완료 알림 (점멸 + 알림음)

### 상태 전환 조건
```
IDLE → SETTING: 시간 추가 버튼
IDLE → RUNNING: 시작 버튼 (시간 설정된 경우)
SETTING → RUNNING: 시작 버튼
RUNNING → PAUSED: 일시정지 버튼 또는 문 열림
PAUSED → RUNNING: 재시작 버튼 (문 닫힌 상태)
RUNNING → COMPLETE: 타이머 완료
ANY → IDLE: 취소 버튼
```

## 사용법

### 버튼 기능
- **btnC (Center)**: 시작/일시정지/재시작
  - IDLE에서 더블클릭: 30초 퀵스타트
- **btnU (Up)**: 10초 추가
- **btnR (Right)**: 1분 추가
- **btnL (Left)**: 문 열기/닫기
- **btnD (Down)**: 취소/리셋
- **reset**: 전체 시스템 리셋

### 디스플레이
- **7-segment**: 설정 시간 또는 남은 시간 표시 (초 단위)
- **IDLE 애니메이션**: 시간이 설정되지 않은 IDLE 상태에서 서클 패턴
- **점멸 효과**: COMPLETE 상태에서 5회 점멸

### 사용 시나리오

#### 기본 사용법:
1. **시간 설정**: btnU(10초) 또는 btnR(1분)으로 원하는 시간 설정
2. **시작**: btnC 눌러서 작동 시작
3. **완료**: 타이머 완료 시 자동으로 알림

#### 퀵스타트:
1. **더블클릭**: IDLE 상태에서 btnC 빠르게 두 번 클릭
2. **즉시 시작**: 30초로 설정되고 바로 작동 시작

## 시스템 구조

```
top_microwave (최상위 모듈)
├── clock_divider - 100MHz → 1Hz 클럭 분주
├── my_button_debounce (×5) - 각 버튼 디바운싱 (10ms)
├── timer_manager - 타이머 관리
│   ├── 시간 설정 (10초/1분 단위)
│   ├── 카운트다운 로직
│   └── 타이머 상태 관리
├── state_controller - 5상태 FSM 제어
│   ├── 상태 전환 로직
│   ├── 더블클릭 감지
│   ├── 점멸 제어
│   └── 제어 신호 생성
├── fnd_controller - 7-segment 제어
│   ├── 시간 표시
│   ├── IDLE 서클 애니메이션
│   └── 점멸 효과
├── servo_controller - 서보모터 문 제어
│   ├── PWM 생성 (20ms 주기)
│   ├── 위치 제어 (0도/90도)
│   └── 문 상태 추적
├── simple_dcmotor - DC모터 플레이트 제어
│   ├── PWM 생성
│   └── 방향 제어
└── buzzer_controller - 부저 제어
    ├── 버튼음 (1000Hz, 0.1초)
    └── 완료음 (800Hz, 1초)
```

## 핵심 알고리즘

### 더블클릭 감지
- 0.5초 윈도우 내에서 두 번의 btnC 입력 감지
- 첫 클릭 후 타이머 시작, 두 번째 클릭 시 퀵스타트 실행

### 점멸 제어
- COMPLETE 상태에서 0.5초 주기로 5회 점멸
- 첫 번째 토글에서 완료 알림음 시작

### 안전 제어
- 문 열림 감지 시 RUNNING → PAUSED 자동 전환
- 문이 닫혀야만 PAUSED → RUNNING 전환 가능

## 하드웨어 사양

### 모터 제어
- **서보모터**: SG90 (PWM 20ms 주기)
  - 0도: 0.5ms 펄스 (문 닫힘)
  - 90도: 2.5ms 펄스 (문 열림)
- **DC모터**: PWM 제어 (정방향 회전만)

### 부저 제어
- **버튼음**: 1000Hz, 0.1초 지속
- **완료음**: 800Hz, 1초 지속

### 디스플레이
- **4자리 7-segment**: 1ms 멀티플렉싱
- **애니메이션**: 0.67초 주기 서클 패턴

## 빌드 및 실행

### 필요 환경
- **FPGA 보드**: Xilinx BASYS-3
- **개발 도구**: Vivado Design Suite
- **언어**: Verilog HDL

### 필요한 파일
- `top_microwave.v`: 최상위 모듈
- `state_controller.v`: 상태 제어
- `timer_manager.v`: 타이머 관리
- `fnd_controller.v`: 디스플레이 제어
- `servo_controller.v`: 서보모터 제어
- `dc_motor.v`: DC모터 제어
- `buzzer_controller.v`: 부저 제어
- `clock_divider.v`: 클럭 분주
- `my_button_debounce.v`: 버튼 디바운싱

### 실행 단계
1. Vivado에서 새 프로젝트 생성
2. 모든 `.v` 파일을 프로젝트에 추가
3. `top_microwave`를 최상위 모듈로 설정
4. BASYS-3 제약 파일(.xdc) 추가
5. Synthesis → Implementation → Generate Bitstream
6. BASYS-3 보드에 프로그래밍

## 리소스 사용량

- **클럭 도메인**: 100MHz 메인 클럭, 1Hz 분주 클럭
- **상태 머신**: 3비트 상태 레지스터
- **타이머**: 12비트 타이머 (최대 3600초)
- **카운터들**:
  - 클럭 분주: 26비트 (50,000,000)
  - 더블클릭 감지: 26비트 (50,000,000)
  - 점멸 제어: 26비트 (50,000,000)
  - PWM 생성: 21비트 (2,000,000)
- **I/O 핀**: 버튼 5개, 7-segment 출력, 모터 제어, 부저

## 특징

- **완전한 FSM 설계**: 안전하고 직관적인 상태 전환
- **실시간 제어**: 정확한 1초 타이밍과 즉각적인 반응
- **사용자 친화적**: 더블클릭 퀵스타트, 시각적 피드백
- **안전 기능**: 문 열림 감지, 자동 일시정지
- **확장 가능**: 모듈형 설계로 기능 추가 용이

## 교육적 가치

- **복합 시스템 설계**: 여러 하위 시스템의 통합
- **상태 머신**: 복잡한 제어 로직의 FSM 구현
- **하드웨어 제어**: PWM, 모터, 센서 인터페이스
- **실시간 시스템**: 타이밍 크리티컬한 제어

---
**개발 환경**: Xilinx Vivado | **타겟 보드**: BASYS-3 | **언어**: Verilog HDL